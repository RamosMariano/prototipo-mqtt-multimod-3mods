# Prototipo MQTT Multim√≥dulos

Proyecto de prototipo IoT basado en **MQTT**, estructurado como **proyecto multim√≥dulo Maven**.  
Incluye simuladores de sensores, un consumidor de mensajes y una API con Spring Boot.

---

## üìÇ Estructura del proyecto

```
prototipo-mqtt-multimod-3mods/
‚îÇ
‚îú‚îÄ‚îÄ api/                # M√≥dulo Spring Boot (exposici√≥n de endpoints REST)
‚îú‚îÄ‚îÄ consumer/           # M√≥dulo Java plano (suscriptor de t√≥picos MQTT)
‚îú‚îÄ‚îÄ simulator/          # M√≥dulo Java plano (publicador de mensajes simulados)
‚îú‚îÄ‚îÄ docker-compose.yml  # Orquestaci√≥n de broker MQTT + servicios
‚îî‚îÄ‚îÄ pom.xml             # POM padre (gestiona dependencias y m√≥dulos)
```

---

## üöÄ Servicios

- **Broker MQTT**: Eclipse Mosquitto (contenedor `broker-mqtt`)
- **Consumer**: Suscribe a t√≥picos MQTT y procesa mensajes
- **Simulator**: Publica datos de sensores simulados (ej. temperatura, humedad)
- **API**: Servicio Spring Boot que en el futuro centralizar√° la l√≥gica y exposici√≥n de datos

---

## ‚ñ∂Ô∏è C√≥mo levantar el stack

1. **Construir im√°genes**
   ```bash
   docker compose build
   ```

2. **Levantar los servicios**
   ```bash
   docker compose up -d
   ```

3. **Ver logs de un servicio (ejemplo: consumer)**
   ```bash
   docker compose logs -f consumer
   ```

4. **Apagar el stack**
   ```bash
   docker compose down
   ```

---

## üì° Flujo MQTT

1. El **simulator** publica mensajes en t√≥picos como:
   ```
   sensors/indoor/temperature
   sensors/outdoor/temperature
   ```

   Ejemplo de mensaje:
   ```json
   {
     "unit": "C",
     "type": "temperature",
     "value": 24.9,
     "sensorId": "indoor-ht",
     "ts": 1759095507207
   }
   ```

2. El **consumer** se suscribe a los t√≥picos, procesa los mensajes y los imprime en logs.

3. El **broker Mosquitto** gestiona la comunicaci√≥n entre publicadores y suscriptores.

---

## ‚è±Ô∏è Configuraci√≥n del intervalo de publicaci√≥n del simulador


Variable de entorno `SIM_PUBLISH_INTERVAL_MS` para definir el **intervalo de publicaci√≥n** en milisegundos (por defecto `300000 ms = 5 min`).

Ejemplo en `docker-compose.yml`:

```yaml
  simulator:
    build:
      context: .
      dockerfile: simulator/Dockerfile
    depends_on:
      - broker-mqtt
    environment:
      - BROKER_HOST=broker-mqtt
      - BROKER_PORT=1883
      - TOPIC_OUTDOOR=sensors/outdoor/temperature
      - TOPIC_INDOOR=sensors/indoor/temperature
      - SETPOINT=21
      # Intervalo de publicaci√≥n en milisegundos (default = 300000 ms = 5 min)
      - SIM_PUBLISH_INTERVAL_MS=${SIM_PUBLISH_INTERVAL_MS:-300000}
```



---

## üõ†Ô∏è Requisitos

- Docker y Docker Compose instalados
- Maven 3.9+ y JDK 17+ (para compilar m√≥dulos)

---

## üìå Pr√≥ximos pasos

- Conectar el **consumer** con la **API Spring Boot**
- Guardar los datos procesados en base de datos
- Exponer endpoints REST en la API para consultar las mediciones
- Agregar tests autom√°ticos con GitHub Actions (CI/CD)

---

## üìú Licencia

Proyecto en desarrollo ‚Äî uso acad√©mico y de pruebas.
